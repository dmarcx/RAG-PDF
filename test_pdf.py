"""
×¡×§×¨×™×¤×˜ ×‘×“×™×§×” ×—×“-×¤×¢××™: ×§×•×¨× ×¢××•×“ 10 ×•××“×¤×™×¡ ×˜×§×¡×˜ + ×˜×‘×œ××•×ª.
×”×¨×¥: python test_pdf.py
"""
import pdfplumber

PDF_PATH = r"pdfs\MPP-AFR-PMG-SCM-GEN-REP 00058.00 Civil Works Outline Design Report.pdf"
PAGE_NUM = 10  # ××™× ×“×§×¡ 0-based â†’ ×¢××•×“ 11 ×‘×§×•×‘×¥? ×œ× â€“ ×›××Ÿ × ×©×ª××© ×‘×¢××•×“ ×”-10 (index 9)

with pdfplumber.open(PDF_PATH) as pdf:
    total = len(pdf.pages)
    print(f"×¡×”×´×› ×¢××•×“×™× ×‘×§×•×‘×¥: {total}")
    print(f"×‘×•×“×§ ×¢××•×“ {PAGE_NUM} (index {PAGE_NUM - 1})\n")

    if PAGE_NUM > total:
        print(f"×©×’×™××”: ×”×§×•×‘×¥ ××›×™×œ ×¨×§ {total} ×¢××•×“×™×.")
        exit(1)

    page = pdf.pages[PAGE_NUM - 1]  # 1-based â†’ 0-based

    # â”€â”€ ×˜×§×¡×˜ ×’×•×œ××™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("=" * 70)
    print("ğŸ“„ PLAIN TEXT (extract_text)")
    print("=" * 70)
    ×˜×§×¡×˜ = page.extract_text()
    print(×˜×§×¡×˜ if ×˜×§×¡×˜ else "(××™×Ÿ ×˜×§×¡×˜ ×‘×¢××•×“ ×–×”)")

    # â”€â”€ ×˜×‘×œ××•×ª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("\n" + "=" * 70)
    print("ğŸ“Š TABLES (extract_tables)")
    print("=" * 70)
    ×˜×‘×œ××•×ª = page.extract_tables()

    if not ×˜×‘×œ××•×ª:
        print("(×œ× × ××¦××• ×˜×‘×œ××•×ª ×‘×¢××•×“ ×–×”)")
    else:
        print(f"× ××¦××• {len(×˜×‘×œ××•×ª)} ×˜×‘×œ××•×ª:\n")
        for i, ×˜×‘×œ××” in enumerate(×˜×‘×œ××•×ª, start=1):
            print(f"â”€â”€ ×˜×‘×œ××” {i} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
            ×›×•×ª×¨×•×ª = [str(×ª× or "").strip() for ×ª× in (×˜×‘×œ××”[0] or [])]
            print("×›×•×ª×¨×•×ª:", " | ".join(×›×•×ª×¨×•×ª))
            print()
            for j, ×©×•×¨×” in enumerate(×˜×‘×œ××”[1:], start=1):
                ×–×•×’×•×ª = [
                    f"{(×›×•×ª×¨×•×ª[k] or '?')}: {(str(×ª× or '')).strip()}"
                    for k, ×ª× in enumerate(×©×•×¨×”)
                    if k < len(×›×•×ª×¨×•×ª)
                ]
                print(f"  [{j:02d}] " + " | ".join(×–×•×’×•×ª))
            print()

    # â”€â”€ ×ª×¦×•×’×ª _page_to_text (××” ×©× ×©××¨ ×‘-ChromaDB ×‘×¤×•×¢×œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("=" * 70)
    print("ğŸ’¾ ××” ×©× ×©××¨ ×‘-ChromaDB (_page_to_text)")
    print("=" * 70)
    from rag import _page_to_text
    print(_page_to_text(page))
